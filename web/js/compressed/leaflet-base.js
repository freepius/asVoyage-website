L.BingLayer=L.TileLayer.extend({options:{subdomains:[0,1,2,3],type:"Aerial",attribution:"Bing",culture:""},initialize:function(b,a){L.Util.setOptions(this,a);this._key=b;this._url=null;this.meta={};this.loadMetadata()},tile2quad:function(a,g,e){var c="";for(var d=e;d>0;d--){var f=0;var b=1<<(d-1);if((a&b)!=0){f+=1}if((g&b)!=0){f+=2}c=c+f}return c},getTileUrl:function(c,d){var d=this._getZoomForUrl();var a=this.options.subdomains,b=this.options.subdomains[Math.abs((c.x+c.y)%a.length)];return this._url.replace("{subdomain}",b).replace("{quadkey}",this.tile2quad(c.x,c.y,d)).replace("{culture}",this.options.culture)},loadMetadata:function(){var d=this;var c="_bing_metadata_"+L.Util.stamp(this);window[c]=function(g){d.meta=g;window[c]=undefined;var f=document.getElementById(c);f.parentNode.removeChild(f);if(g.errorDetails){alert("Got metadata"+g.errorDetails);return}d.initMetadata()};var b="http://dev.virtualearth.net/REST/v1/Imagery/Metadata/"+this.options.type+"?include=ImageryProviders&jsonp="+c+"&key="+this._key;var a=document.createElement("script");a.type="text/javascript";a.src=b;a.id=c;document.getElementsByTagName("head")[0].appendChild(a)},initMetadata:function(){var e=this.meta.resourceSets[0].resources[0];this.options.subdomains=e.imageUrlSubdomains;this._url=e.imageUrl;this._providers=[];for(var b=0;b<e.imageryProviders.length;b++){var g=e.imageryProviders[b];for(var a=0;a<g.coverageAreas.length;a++){var h=g.coverageAreas[a];var f={zoomMin:h.zoomMin,zoomMax:h.zoomMax,active:false};var d=new L.LatLngBounds(new L.LatLng(h.bbox[0]+0.01,h.bbox[1]+0.01),new L.LatLng(h.bbox[2]-0.01,h.bbox[3]-0.01));f.bounds=d;f.attrib=g.attribution;this._providers.push(f)}}this._update()},_update:function(){if(this._url==null||!this._map){return}this._update_attribution();L.TileLayer.prototype._update.apply(this,[])},_update_attribution:function(){var c=this._map.getBounds();var b=this._map.getZoom();for(var a=0;a<this._providers.length;a++){var d=this._providers[a];if((b<=d.zoomMax&&b>=d.zoomMin)&&c.intersects(d.bounds)){if(!d.active){this._map.attributionControl.addAttribution(d.attrib)}d.active=true}else{if(d.active){this._map.attributionControl.removeAttribution(d.attrib)}d.active=false}}},onRemove:function(c){for(var a=0;a<this._providers.length;a++){var b=this._providers[a];if(b.active){this._map.attributionControl.removeAttribution(b.attrib);b.active=false}}L.TileLayer.prototype.onRemove.apply(this,[c])}});(function(b,a,c){L.AwesomeMarkers={};L.AwesomeMarkers.version="1.0";L.AwesomeMarkers.Icon=L.Icon.extend({options:{iconSize:[35,45],iconAnchor:[17,42],popupAnchor:[1,-32],shadowAnchor:[10,12],shadowSize:[36,16],className:"awesome-marker",icon:"home",color:"blue",iconColor:"white"},initialize:function(d){d=L.setOptions(this,d)},createIcon:function(){var d=a.createElement("div"),f=this.options;if(f.icon){d.innerHTML=this._createInner()}if(f.bgPos){d.style.backgroundPosition=-f.bgPos.x+"px "+-f.bgPos.y+"px"}this._setIconStyles(d,"icon-"+f.color);return d},_createInner:function(){var d;if(this.options.icon.slice(0,5)==="icon-"){d=this.options.icon}else{d="icon-"+this.options.icon}return"<i class='"+d+(this.options.spin?" icon-spin":"")+(this.options.iconColor?" icon-"+this.options.iconColor:"")+"'></i>"},_setIconStyles:function(h,f){var j=this.options,g=L.point(j[f=="shadow"?"shadowSize":"iconSize"]),d;if(f==="shadow"){d=L.point(j.shadowAnchor||j.iconAnchor)}else{d=L.point(j.iconAnchor)}if(!d&&g){d=g.divideBy(2,true)}h.className="awesome-marker-"+f+" "+j.className;if(d){h.style.marginLeft=-d.x+"px";h.style.marginTop=-d.y+"px"}if(g){h.style.width=g.x+"px";h.style.height=g.y+"px"}},createShadow:function(){var d=a.createElement("div"),f=this.options;this._setIconStyles(d,"shadow");return d}});L.AwesomeMarkers.icon=function(d){return new L.AwesomeMarkers.Icon(d)}})(this,document)(function(b,a,c){L.labelVersion="0.2.0-dev";L.Label=L.Class.extend({includes:L.Mixin.Events,options:{className:"",clickable:false,direction:"right",noHide:false,offset:[12,-15],opacity:1,zoomAnimation:true},initialize:function(d,e){L.setOptions(this,d);this._source=e;this._animated=L.Browser.any3d&&this.options.zoomAnimation;this._isOpen=false},onAdd:function(d){this._map=d;this._pane=this._source instanceof L.Marker?d._panes.markerPane:d._panes.popupPane;if(!this._container){this._initLayout()}this._updateContent();this._pane.appendChild(this._container);d.on("moveend",this._onMoveEnd,this).on("viewreset",this._onViewReset,this);if(this._animated){d.on("zoomanim",this._zoomAnimation,this)}if(L.Browser.touch&&!this.options.noHide){L.DomEvent.on(this._container,"click",this.close,this)}this._initInteraction();this._update();this.setOpacity(this.options.opacity)},onRemove:function(d){this._pane.removeChild(this._container);d.off({zoomanim:this._zoomAnimation,moveend:this._onMoveEnd,viewreset:this._onViewReset},this);this._removeInteraction();this._map=null},setLatLng:function(d){this._latlng=L.latLng(d);if(this._map){this._updatePosition()}return this},setContent:function(d){this._content=d;this._update();return this},close:function(){var d=this._map;if(d){if(L.Browser.touch&&!this.options.noHide){L.DomEvent.off(this._container,"click",this.close)}d.removeLayer(this)}},updateZIndex:function(d){this._zIndex=d;if(this._container&&this._zIndex){this._container.style.zIndex=d}},setOpacity:function(d){this.options.opacity=d;if(this._container){L.DomUtil.setOpacity(this._container,d)}},_initLayout:function(){this._container=L.DomUtil.create("div","leaflet-label "+this.options.className+" leaflet-zoom-animated");this.updateZIndex(this._zIndex)},_update:function(){if(!this._map){return}this._container.style.visibility="hidden";this._updateContent();this._updatePosition();this._container.style.visibility=""},_updateContent:function(){if(!this._content){return}if(typeof this._content==="string"){this._container.innerHTML=this._content;this._labelWidth=this._container.offsetWidth}},_updatePosition:function(){var d=this._map.latLngToLayerPoint(this._latlng);this._setPosition(d)},_setPosition:function(k){var h=this._map,e=this._container,j=h.latLngToContainerPoint(h.getCenter()),f=h.layerPointToContainerPoint(k),g=this.options.direction,d=this._labelWidth,i=L.point(this.options.offset);if(g==="right"||g==="auto"&&f.x<j.x){L.DomUtil.addClass(e,"leaflet-label-right");L.DomUtil.removeClass(e,"leaflet-label-left");k=k.add(i)}else{L.DomUtil.addClass(e,"leaflet-label-left");L.DomUtil.removeClass(e,"leaflet-label-right");k=k.add(L.point(-i.x-d,i.y))}L.DomUtil.setPosition(e,k)},_zoomAnimation:function(d){var e=this._map._latLngToNewLayerPoint(this._latlng,d.zoom,d.center);this._setPosition(e)},_onMoveEnd:function(){if(!this._animated||this.options.direction==="auto"){this._updatePosition()}},_onViewReset:function(d){if(d&&d.hard){this._update()}},_initInteraction:function(){if(!this.options.clickable){return}var d=this._container,f=["dblclick","mousedown","mouseover","mouseout","contextmenu"];L.DomUtil.addClass(d,"leaflet-clickable");L.DomEvent.on(d,"click",this._onMouseClick,this);for(var e=0;e<f.length;e++){L.DomEvent.on(d,f[e],this._fireMouseEvent,this)}},_removeInteraction:function(){if(!this.options.clickable){return}var d=this._container,f=["dblclick","mousedown","mouseover","mouseout","contextmenu"];L.DomUtil.removeClass(d,"leaflet-clickable");L.DomEvent.off(d,"click",this._onMouseClick,this);for(var e=0;e<f.length;e++){L.DomEvent.off(d,f[e],this._fireMouseEvent,this)}},_onMouseClick:function(d){if(this.hasEventListeners(d.type)){L.DomEvent.stopPropagation(d)}this.fire(d.type,{originalEvent:d})},_fireMouseEvent:function(d){this.fire(d.type,{originalEvent:d});if(d.type==="contextmenu"&&this.hasEventListeners(d.type)){L.DomEvent.preventDefault(d)}if(d.type!=="mousedown"){L.DomEvent.stopPropagation(d)}else{L.DomEvent.preventDefault(d)}}});L.BaseMarkerMethods={showLabel:function(){if(this.label&&this._map){this.label.setLatLng(this._latlng);this._map.showLabel(this.label)}return this},hideLabel:function(){if(this.label){this.label.close()}return this},setLabelNoHide:function(d){if(this._labelNoHide===d){return}this._labelNoHide=d;if(d){this._removeLabelRevealHandlers();this.showLabel()}else{this._addLabelRevealHandlers();this.hideLabel()}},bindLabel:function(g,f){var d=this.options.icon?this.options.icon.options.labelAnchor:this.options.labelAnchor,e=L.point(d)||L.point(0,0);e=e.add(L.Label.prototype.options.offset);if(f&&f.offset){e=e.add(f.offset)}f=L.Util.extend({offset:e},f);this._labelNoHide=f.noHide;if(!this.label){if(!this._labelNoHide){this._addLabelRevealHandlers()}this.on("remove",this.hideLabel,this).on("move",this._moveLabel,this).on("add",this._onMarkerAdd,this);this._hasLabelHandlers=true}this.label=new L.Label(f,this).setContent(g);return this},unbindLabel:function(){if(this.label){this.hideLabel();this.label=null;if(this._hasLabelHandlers){if(!this._labelNoHide){this._removeLabelRevealHandlers()}this.off("remove",this.hideLabel,this).off("move",this._moveLabel,this).off("add",this._onMarkerAdd,this)}this._hasLabelHandlers=false}return this},updateLabelContent:function(d){if(this.label){this.label.setContent(d)}},getLabel:function(){return this.label},_onMarkerAdd:function(){if(this._labelNoHide){this.showLabel()}},_addLabelRevealHandlers:function(){this.on("mouseover",this.showLabel,this).on("mouseout",this.hideLabel,this);if(L.Browser.touch){this.on("click",this.showLabel,this)}},_removeLabelRevealHandlers:function(){this.off("mouseover",this.showLabel,this).off("mouseout",this.hideLabel,this);if(L.Browser.touch){this.off("click",this.showLabel,this)}},_moveLabel:function(d){this.label.setLatLng(d.latlng)}};L.Icon.Default.mergeOptions({labelAnchor:new L.Point(9,-20)});L.Marker.mergeOptions({icon:new L.Icon.Default()});L.Marker.include(L.BaseMarkerMethods);L.Marker.include({_originalUpdateZIndex:L.Marker.prototype._updateZIndex,_updateZIndex:function(d){var e=this._zIndex+d;this._originalUpdateZIndex(d);if(this.label){this.label.updateZIndex(e)}},_originalSetOpacity:L.Marker.prototype.setOpacity,setOpacity:function(e,d){this.options.labelHasSemiTransparency=d;this._originalSetOpacity(e)},_originalUpdateOpacity:L.Marker.prototype._updateOpacity,_updateOpacity:function(){var d=this.options.opacity===0?0:1;this._originalUpdateOpacity();if(this.label){this.label.setOpacity(this.options.labelHasSemiTransparency?this.options.opacity:d)}}});L.CircleMarker.mergeOptions({labelAnchor:new L.Point(0,0)});L.CircleMarker.include(L.BaseMarkerMethods);L.Path.include({bindLabel:function(e,d){if(!this.label||this.label.options!==d){this.label=new L.Label(d,this)}this.label.setContent(e);if(!this._showLabelAdded){this.on("mouseover",this._showLabel,this).on("mousemove",this._moveLabel,this).on("mouseout remove",this._hideLabel,this);if(L.Browser.touch){this.on("click",this._showLabel,this)}this._showLabelAdded=true}return this},unbindLabel:function(){if(this.label){this._hideLabel();this.label=null;this._showLabelAdded=false;this.off("mouseover",this._showLabel,this).off("mousemove",this._moveLabel,this).off("mouseout remove",this._hideLabel,this)}return this},updateLabelContent:function(d){if(this.label){this.label.setContent(d)}},_showLabel:function(d){this.label.setLatLng(d.latlng);this._map.showLabel(this.label)},_moveLabel:function(d){this.label.setLatLng(d.latlng)},_hideLabel:function(){this.label.close()}});L.Map.include({showLabel:function(d){return this.addLayer(d)}});L.FeatureGroup.include({clearLayers:function(){this.unbindLabel();this.eachLayer(this.removeLayer,this);return this},bindLabel:function(e,d){return this.invoke("bindLabel",e,d)},unbindLabel:function(){return this.invoke("unbindLabel")},updateLabelContent:function(d){this.invoke("updateLabelContent",d)}})}(this,document));